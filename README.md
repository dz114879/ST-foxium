# ST-Foxium

Foxium 是一个专为 **SillyTavern** 设计的综合性维护脚本，集成了修复、优化和备份三大核心功能。旨在帮助用户解决常见的酒馆运行问题，优化使用体验，并保障数据安全。

> ⚠️ **注意**：本工具涉及对 SillyTavern 核心文件的修改，尽管包含自动备份机制，但在执行高风险操作前，请务必确认您已了解相关风险。

---

## 🚀 快速开始

在 Termux 或 Linux 环境下，**将脚本放在和装着整个sillytavern的文件夹的同目录下**（不是酒馆根目录），然后直接运行脚本即可：

```bash
bash foxium.sh
```

或者赋予执行权限后运行：

```bash
chmod +x foxium.sh
./foxium.sh
```

脚本会自动检测您的 SillyTavern 目录、用户目录和备份目录。

---

## 🛠️ 功能列表

### 1. 修复功能 (Fix)
针对导致酒馆无法启动、卡死或功能异常的问题进行修复。

- **修复 npm 安装问题**: 自动备份并重建 `node_modules`，使用国内镜像源重新安装依赖。适用于缺少包导致的启动失败。
- **修复 UI 主题卡死**: 当选择了错误的主题导致网页无法加载时，强制将主题重置为默认的 `Dark Lite`。
- **修复扩展无法卸载**: 强制删除因程序漏洞而无法在网页端卸载的扩展。
- **修复端口冲突**: 修改 `config.yaml` 端口设置，解决端口被占用无法启动的问题。
- **修复聊天加载卡死**: 禁用“自动加载聊天”并开启“角色懒加载”，允许进入酒馆手动删除损坏或超大的聊天记录。
- **强制更新 ST**: 解决因分支错误或本地修改冲突导致的更新失败，强制切换至 `release` 分支并更新。
- **优化旧版内存占用**: 修复 1.13.5 之前版本存在的内存泄漏问题 (爆内存崩溃)。
- **修复 Gemini-3 媒体发送**: (风险操作) 修改核心文件，允许旧版酒馆向 Gemini-3 系列模型发送图片、视频和音频。

### 2. 优化功能 (Optimize)
提升酒馆的使用体验和性能限制。

- **解除聊天记录大小限制**: 将上传限制从 500MB 提升至 9999MB，防止超大聊天记录导致崩溃。
- **更新模型列表**: 在旧版本酒馆的下拉菜单中添加最新的 Gemini (3系列) 和 Claude (4.5系列) 模型选项。
- **修改内存限制**: 一键修改 `start.sh` 或 `Start.bat`，自定义 Node.js 的内存上限 (如 4GB/8GB)，防止内存溢出。
- **强解模型能力限制**: (高风险) 强制开启所有模型的多模态能力 (发送图片/视频/音频)，绕过前端限制。

### 3. 备份功能 (Backup)
强大的数据备份系统，支持手动和自动备份。

- **手动备份**: 支持单独备份世界书、角色卡、预设、聊天记录、配置文件等，或一键全量备份。
- **自动备份**: 向启动脚本 (`start.sh` 或 `Start.bat`) 注入自动备份代码。启用后，每次启动酒馆时会自动备份核心数据 (保留最新的一个备份)，防止意外丢档。

---

## 📂 目录结构说明

脚本运行时会使用或创建以下目录：

- **ST 目录**: 自动识别 SillyTavern 安装路径。
- **备份目录**: 默认为脚本所在目录下的 `STbackupF`。
- **用户目录**: 默认为 `SillyTavern/data/default-user` (支持自定义用户名)。

---

## 📝 免责声明

1. 使用本工具产生的任何后果（包括但不限于数据丢失、文件损坏）由用户自行承担。
2. 部分功能涉及修改 SillyTavern 源代码，更新酒馆后相关修改可能会失效，需重新运行本脚本应用。

---

*Created with ❤️ by KKTsN & limcode*
